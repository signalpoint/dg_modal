function dg_modal_blocks_build_alter(t){var o=t.modal._attributes.class;dg.inArray("modal",o)||o.push("modal")}function dg_modal_post_process_route_change(t,o,e){var d=dg_modal.getStack();if(d.length)for(;d.length;){var a=d.pop();dg_modal.delete(a)}}dg.createModule("dg_modal"),dg._modal=null,dg._modals={},dg_modal._stack=[],dg_modal.getStack=function(){return dg_modal._stack},dg_modal.stackPush=function(t){dg_modal.getStack().push(t)},dg_modal.stackPop=function(){return dg_modal.getStack().pop()},DgModal=function(t){var o=dg.qs("#"+t);if(!o){o=document.createElement("div"),o.setAttribute("id",t),o.classList.add("modal");var e=dg_modal.getStack(),d=e.length?e[e.length-1]:"modal",a=dg.qs("#"+d);a.parentNode.insertBefore(o,a.nextSibling)}this._id=t,this._block=o,this._content=null,this._alertCallback=null},DgModal.prototype.id=function(){return this._id},DgModal.prototype.getBlock=function(){return this._block},DgModal.prototype.setAttributes=function(t){dg.addAttrs(this.getBlock(),{_attributes:t})},DgModal.prototype.setAlertCallback=function(t){this._alertCallback=t},DgModal.prototype.getAlertCallback=function(){return this._alertCallback},DgModal.prototype.isOpen=function(){return"block"==this.getBlock().style.display},DgModal.prototype.open=function(){dg.show(this.getBlock()),dg_modal.stackPush(this.id())},DgModal.prototype.close=function(){dg.hide(this.getBlock());var t=this.getAlertCallback();t?t():null,dg_modal.stackPop()},DgModal.prototype.setContent=function(t){t._theme="modal_wrapper",this.getBlock().innerHTML=dg.render(t)},DgModal.prototype.clearContent=function(){this.getBlock().innerHTML=""},DgModal.prototype.onkeydown=function(t){t=t||window.event;var o=!1;if(o="key"in t?"Escape"==t.key||"Esc"==t.key:27==t.keyCode){var e=dg_modal.loadRecent();e.isOpen()&&e.close()}},DgModal.prototype.onclick=function(t){var o=dg_modal.loadRecent(),e=o.getBlock();t.target==e&&o.isOpen()&&o.close()},dg_modal.blocks=function(){var t={};return t.modal={build:function(){return new Promise(function(t,o){t({modal:{_markup:""}})})}},t},dg_modal.load=function(t){t||(t="modal");var o=new DgModal(t);return dg._modals[t]=o,window.addEventListener("keydown",o.onkeydown,!1),window.addEventListener("click",o.onclick,!1),o},dg_modal.loadRecent=function(){var t=dg_modal.getStack();return dg_modal.load(t.length?t[t.length-1]:"modal")},dg_modal.delete=function(t){"modal"!=t&&dg._modals[t]&&delete dg._modals[t]},dg_modal.isOpen=function(t){if(t)return dg_modal.load(t).isOpen();var o=dg._modals;for(t in o)if(o.hasOwnProperty(t)){var e=o[t];if(e.isOpen())return!0}return!1},dg_modal.close=function(t){if(t)dg_modal.load(t).close();else{var o=dg._modals;for(t in o)if(o.hasOwnProperty(t)){var e=o[t];e.close()}}},dg_modal.alert=function(t,o){o||(o={}),dg.attributesInit(o);var e=o._attributes;dg.inArray("modal",e.class)||e.class.push("modal");var d=o.type?o.type:"default",a={default:"Alert",status:"Status",warning:"Warning",error:"Error"},l=dg.t(a[d]?a[d]:"Alert"),n=o.alertCallback?o.alertCallback:null;"undefined"!==o.title&&(l=o.title);var r=o.buttonName?o.buttonName:dg.t("OK"),i=o.id?dg_modal.load(o.id):dg_modal.load();i.setAttributes(e),i.setAlertCallback(n),i.setContent({_modal:i,_attributes:{class:[d]},_title:l,_content:t,_footer:r}),i.open()},dg.modal=dg_modal.alert,dg.alert||(dg.alert=dg_modal.alert),dg_modal.confirm=function(t,o){},dg.modalConfirm=dg_modal.confirm,dg.confirm||(dg.confirm=dg_modal.confirm),dg.theme_modal_content=function(t){return t._attributes.class.push("modal-content"),"<div "+dg.attrs(t)+">"+dg.render(t._content)+"</div>"},dg.theme_modal_footer=function(t){return t._attributes.class.push("modal-footer"),"<div "+dg.attrs(t)+">"+dg.b(t._title,{_attributes:{onclick:"dg_modal.close()"}})+"</div>"},dg.theme_modal_header=function(t){t._attributes.class.push("modal-header");var o="<div "+dg.attrs(t)+'><span class="modal-close" onclick="dg_modal.close(\''+t._modal.id()+"')\">&times;</span>";return t._title&&(o+="<h2>"+t._title+"</h2>"),o+="</div>"},dg.theme_modal_wrapper=function(t){var o=t._modal;t._attributes.class.push("modal-wrapper");var e="<div "+dg.attrs(t)+">";return e+=dg.render({_theme:"modal_header",_title:t._title,_modal:o}),t._content&&(e+=dg.render({_theme:"modal_content",_content:t._content,_modal:o})),t._footer&&(e+=dg.render({_theme:"modal_footer",_title:t._footer,_modal:o})),e+"</div>"};